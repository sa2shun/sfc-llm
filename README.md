# SFC-LLM

Keio SFCã®æˆæ¥­ã‚·ãƒ©ãƒã‚¹ã‚’æ¤œç´¢ã—ã€LLMã§è‡ªç„¶è¨€èªå›ç­”ã™ã‚‹ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚  
Milvus ã«ã‚ˆã‚‹ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ï¼ˆRAGï¼‰ã‚’ä½¿ã£ã¦é–¢é€£æƒ…å ±ã‚’å–å¾—ã—ã€Meta Llama 3 ãƒ¢ãƒ‡ãƒ«ã§å¿œç­”ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

---

## ğŸ”§ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
.
â”œâ”€â”€ src/                     # ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ __init__.py          # Pythonãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–
â”‚   â”œâ”€â”€ chat_server.py       # FastAPI ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æœ¬ä½“
â”‚   â”œâ”€â”€ config.py            # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ milvus_search.py     # Milvus ã«ã‚ˆã‚‹æ¤œç´¢å‡¦ç†
â”‚   â”œâ”€â”€ prompts.py           # LLMãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”‚   â”œâ”€â”€ test_chat.py         # å‹•ä½œç¢ºèªç”¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â””â”€â”€ test_collections.py  # ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å­˜åœ¨ç¢ºèª
â”œâ”€â”€ utils/                   # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
â”‚   â”œâ”€â”€ __init__.py          # Pythonãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–
â”‚   â”œâ”€â”€ embedding.py         # åŸ‹ã‚è¾¼ã¿ãƒ™ã‚¯ãƒˆãƒ«ç”Ÿæˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â””â”€â”€ llm.py               # LLMé–¢é€£ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”œâ”€â”€ scripts/                 # å®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”œâ”€â”€ __init__.py          # Pythonãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–
â”‚   â”œâ”€â”€ init_syllabus_collection.py  # Milvus ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ä½œæˆï¼‹ãƒ‡ãƒ¼ã‚¿æŠ•å…¥
â”‚   â”œâ”€â”€ test_search_performance.py   # æ¤œç´¢æ€§èƒ½è©•ä¾¡ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â””â”€â”€ start_server.py              # ã‚µãƒ¼ãƒãƒ¼èµ·å‹•è£œåŠ©ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ csvs/                    # ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â””â”€â”€ sfc_syllabus.csv     # æˆæ¥­ãƒ‡ãƒ¼ã‚¿
â””â”€â”€ models/                  # ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«
    â””â”€â”€ mixtral/             # LLMãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«
```

---

## ğŸš€ èµ·å‹•æ‰‹é †

### 1. ç’°å¢ƒå¤‰æ•°ã®è¨­å®šï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰

```bash
# HuggingFace APIãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆå¿…é ˆï¼‰
export HUGGINGFACE_TOKEN="your_token_here"

# ãƒ¢ãƒ‡ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºï¼ˆä»»æ„ï¼‰
export SFC_LLM_MODEL_DIR="/path/to/model/directory"

# åŸ‹ã‚è¾¼ã¿ãƒ¢ãƒ‡ãƒ«ã®ãƒ‡ãƒã‚¤ã‚¹è¨­å®šï¼ˆä»»æ„ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯CPUï¼‰
export SFC_LLM_EMBEDDING_DEVICE="cuda:0"

# APIã‚µãƒ¼ãƒãƒ¼ã®ãƒ›ã‚¹ãƒˆãƒ»ãƒãƒ¼ãƒˆè¨­å®šï¼ˆä»»æ„ï¼‰
export SFC_LLM_API_HOST="0.0.0.0"
export SFC_LLM_API_PORT="8001"
```

### 2. ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆåˆå›ã®ã¿ï¼‰

```bash
# Poetry ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ
poetry install

# ã¾ãŸã¯ç›´æ¥ pip ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ
pip install -r requirements.txt
```

### 3. Milvus ã«ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ä½œæˆï¼ˆåˆå›ã®ã¿ï¼‰

```bash
python scripts/init_syllabus_collection.py
```

### 4. FastAPI ã‚µãƒ¼ãƒãƒ¼èµ·å‹•

```bash
# ä¾¿åˆ©ãªèµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ï¼ˆæ¨å¥¨ï¼‰
python scripts/start_server.py  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰ (127.0.0.1)

# ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•ï¼ˆå¤–éƒ¨ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼‰
python scripts/start_server.py --global

# èªè¨¼ãªã—ã§èµ·å‹•
python scripts/start_server.py --no-auth

# ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ¢ãƒ¼ãƒ‰ã‹ã¤èªè¨¼ãªã—ã§èµ·å‹•
python scripts/start_server.py --global --no-auth

# ã¾ãŸã¯ç›´æ¥èµ·å‹•
python -m src.chat_server

# ã¾ãŸã¯ uvicorn ã‚’ä½¿ç”¨
uvicorn src.chat_server:app --host 0.0.0.0 --port 8001
```

### èªè¨¼è¨­å®š

ã‚µãƒ¼ãƒãƒ¼ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã¾ã™ã€‚ä»¥ä¸‹ã®ç’°å¢ƒå¤‰æ•°ã§è¨­å®šã‚’å¤‰æ›´ã§ãã¾ã™ï¼š

```bash
# èªè¨¼ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®è¨­å®šï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: "kawallmshima"ï¼‰
export SFC_LLM_API_PASSWORD="your_password_here"

# èªè¨¼ã®æœ‰åŠ¹/ç„¡åŠ¹åˆ‡ã‚Šæ›¿ãˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: trueï¼‰
export SFC_LLM_API_REQUIRE_AUTH="false"  # èªè¨¼ã‚’ç„¡åŠ¹åŒ–
```

å¤–éƒ¨ã‹ã‚‰APIã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å ´åˆã¯ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã« `X-API-Key` ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

```bash
# curlã®ä¾‹
curl -H "X-API-Key: kawallmshima" \
     -H "Content-Type: application/json" \
     -d '{"user_input":"ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®æˆæ¥­ã‚’æ•™ãˆã¦ãã ã•ã„"}' \
     http://your-server:8001/chat
```

### 5. å‹•ä½œç¢ºèªã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®å®Ÿè¡Œ

```bash
# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¯ã‚¨ãƒªã‚’ä½¿ç”¨
python src/test_chat.py

# ã‚«ã‚¹ã‚¿ãƒ ã‚¯ã‚¨ãƒªã‚’æŒ‡å®š
python src/test_chat.py "ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®æˆæ¥­ã‚’æ•™ãˆã¦ãã ã•ã„"

# è©³ç´°æƒ…å ±ã‚’è¡¨ç¤º
python src/test_chat.py -v

# ã‚«ã‚¹ã‚¿ãƒ APIã‚­ãƒ¼ã‚’æŒ‡å®š
python src/test_chat.py -k "your_api_key" "ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®æˆæ¥­ã‚’æ•™ãˆã¦ãã ã•ã„"
```

### 6. æ¤œç´¢æ€§èƒ½ã®ãƒ†ã‚¹ãƒˆ

```bash
# æ¤œç´¢æ€§èƒ½ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ
python scripts/test_search_performance.py
```

### æ³¨æ„äº‹é …: Pythonãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«ã¤ã„ã¦

ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç›´æ¥å®Ÿè¡Œã™ã‚‹éš›ã«ã€ŒModuleNotFoundError: No module named 'src'ã€ãªã©ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã®æ–¹æ³•ã§è§£æ±ºã§ãã¾ã™ï¼š

1. **ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦å®Ÿè¡Œã™ã‚‹**:
   ```bash
   python -m src.test_chat "ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®æˆæ¥­ã‚’æ•™ãˆã¦ãã ã•ã„"
   ```

2. **PYTHONPATHç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã™ã‚‹**:
   ```bash
   PYTHONPATH=. python src/test_chat.py "ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®æˆæ¥­ã‚’æ•™ãˆã¦ãã ã•ã„"
   ```

3. **æ—¢ã«ä¿®æ­£æ¸ˆã¿ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã™ã‚‹**:
   å„ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã€Pythonãƒ‘ã‚¹ã‚’è‡ªå‹•çš„ã«è¨­å®šã™ã‚‹ã‚³ãƒ¼ãƒ‰ãŒè¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ã€‚

---

## ğŸ“¦ ä½¿ç”¨æŠ€è¡“

- **LLM**: Meta Llama 3 70B Instructï¼ˆHuggingFaceï¼‰
- **æ¤œç´¢**: Milvusï¼ˆãƒ­ãƒ¼ã‚«ãƒ«DBãƒ¢ãƒ¼ãƒ‰ï¼‰
- **åŸ‹ã‚è¾¼ã¿**: SentenceTransformer (`all-MiniLM-L6-v2`)
- **APIã‚µãƒ¼ãƒãƒ¼**: FastAPI

---

## ğŸ” ä¸»ãªæ©Ÿèƒ½

- **æœ€é©åŒ–ã•ã‚ŒãŸæ¤œç´¢**: æˆæ¥­æ¦‚è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ç‰¹åŒ–ã—ãŸã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«ã‚ˆã‚‹é«˜é€Ÿæ¤œç´¢
- **RAGåˆ¤å®š**: è³ªå•å†…å®¹ã«å¿œã˜ã¦è‡ªå‹•çš„ã«RAGãŒå¿…è¦ã‹ã©ã†ã‹ã‚’åˆ¤æ–­
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½**: ãƒ¢ãƒ‡ãƒ«ã‚„åŸ‹ã‚è¾¼ã¿é–¢æ•°ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã‚ˆã‚‹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: å …ç‰¢ãªã‚¨ãƒ©ãƒ¼å‡¦ç†ã¨è©³ç´°ãªãƒ­ã‚°å‡ºåŠ›
- **è¨­å®šã®æŸ”è»Ÿæ€§**: ç’°å¢ƒå¤‰æ•°ã«ã‚ˆã‚‹å„ç¨®è¨­å®šã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ**: æ¤œç´¢æ€§èƒ½ã‚’è©•ä¾¡ã™ã‚‹ãŸã‚ã®ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- **APIèªè¨¼**: å¤–éƒ¨å…¬é–‹æ™‚ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç¢ºä¿ã®ãŸã‚ã®APIã‚­ãƒ¼èªè¨¼
- **ãƒ­ãƒ¼ã‚«ãƒ«/ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ¢ãƒ¼ãƒ‰**: ç”¨é€”ã«å¿œã˜ãŸã‚µãƒ¼ãƒãƒ¼èµ·å‹•ãƒ¢ãƒ¼ãƒ‰ã®åˆ‡ã‚Šæ›¿ãˆ

### æ¤œç´¢æ€§èƒ½ã®æœ€é©åŒ–

æ¤œç´¢æ€§èƒ½ã‚’å‘ä¸Šã•ã›ã‚‹ãŸã‚ã«ä»¥ä¸‹ã®æœ€é©åŒ–ã‚’è¡Œã£ã¦ã„ã¾ã™ï¼š

1. **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰é•·ã®æœ€é©åŒ–**: å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æœ€å¤§é•·ã‚’å¿…è¦æœ€å°é™ã«è¨­å®š
2. **ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æˆ¦ç•¥**: ã€Œæˆæ¥­æ¦‚è¦ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ç‰¹åŒ–ã—ãŸã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½œæˆ
3. **æ¤œç´¢ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ **: æœ€ã‚‚é–¢é€£æ€§ã®é«˜ã„æƒ…å ±ã‚’å«ã‚€ã€Œæˆæ¥­æ¦‚è¦ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å„ªå…ˆçš„ã«æ¤œç´¢

---

## ğŸ”§ Docker ã‚’ä½¿ç”¨ã—ãŸèµ·å‹•

### Docker Compose ã§ã®èµ·å‹•ï¼ˆæ¨å¥¨ï¼‰

```bash
# ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
cp .env.example .env
# .envãƒ•ã‚¡ã‚¤ãƒ«ã§HUGGINGFACE_TOKENã‚’è¨­å®š

# å…¨ã‚µãƒ¼ãƒ“ã‚¹ã‚’èµ·å‹•ï¼ˆMilvus + SFC-LLMï¼‰
docker-compose up -d

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–
docker-compose exec sfc-llm python scripts/init_syllabus_collection.py

# å‹•ä½œç¢ºèª
docker-compose exec sfc-llm python src/test_chat.py

# ãƒ­ã‚°ç¢ºèª
docker-compose logs sfc-llm

# ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢
docker-compose down

# å®Œå…¨ãƒªã‚»ãƒƒãƒˆï¼ˆãƒ‡ãƒ¼ã‚¿ã‚‚å‰Šé™¤ï¼‰
docker-compose down -v
```

### Docker ã®åˆ©ç‚¹

- **ç°¡å˜ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**: Milvus ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚‚å«ã‚ã¦ä¸€æ‹¬èµ·å‹•
- **ç’°å¢ƒåˆ†é›¢**: ãƒ›ã‚¹ãƒˆç’°å¢ƒã¸ã®å½±éŸ¿ãªã—
- **å†ç¾æ€§**: ç•°ãªã‚‹ç’°å¢ƒã§ã®ä¸€è²«ã—ãŸå‹•ä½œ
- **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**: å®¹æ˜“ãªæ°´å¹³ã‚¹ã‚±ãƒ¼ãƒ«

---

## âš¡ æ€§èƒ½æœ€é©åŒ–ã‚¬ã‚¤ãƒ‰

### ç¾åœ¨ã®æ€§èƒ½ç‰¹æ€§

- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“**: 5-10ç§’ï¼ˆé€šå¸¸ã®ã‚¯ã‚¨ãƒªï¼‰
- **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡**: 8-16GBï¼ˆ70Bãƒ¢ãƒ‡ãƒ«ä½¿ç”¨æ™‚ï¼‰
- **åŒæ™‚å‡¦ç†**: 1-2ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

### æ¨å¥¨æœ€é©åŒ–æ‰‹æ³•

#### 1. LLMãƒ¢ãƒ‡ãƒ«æœ€é©åŒ–ï¼ˆæœ€é‡è¦ï¼‰

```python
# utils/llm.py ã§ã®å®Ÿè£…ä¾‹
@lru_cache(maxsize=1)
def get_model() -> AutoModelForCausalLM:
    model = AutoModelForCausalLM.from_pretrained(
        LOCAL_MODEL_DIR,
        device_map="auto",
        torch_dtype=torch.float16,  # Halfç²¾åº¦ã§é«˜é€ŸåŒ–
        load_in_8bit=True,         # 8bité‡å­åŒ–ã§ãƒ¡ãƒ¢ãƒª50%å‰Šæ¸›
        use_cache=True,            # KVã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ‰åŠ¹åŒ–
        token=HF_TOKEN
    )
    
    # PyTorch 2.0 ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æœ€é©åŒ–
    if hasattr(torch, 'compile'):
        model = torch.compile(model, mode="reduce-overhead")
    
    return model
```

**æœŸå¾…åŠ¹æœ**: ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡50%å‰Šæ¸›ã€æ¨è«–é€Ÿåº¦20-30%å‘ä¸Š

#### 2. æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ æœ€é©åŒ–

```python
# src/milvus_search.py ã§ã®å®Ÿè£…ä¾‹
from functools import lru_cache
import hashlib

@lru_cache(maxsize=100)
def search_syllabus_cached(query_hash: str, top_k: int):
    """æ¤œç´¢çµæœã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦é«˜é€ŸåŒ–"""
    return _search_syllabus_internal(query_hash, top_k)

def search_syllabus(query: str, top_k=RAG_TOP_K):
    query_hash = hashlib.md5(query.encode()).hexdigest()
    return search_syllabus_cached(query_hash, top_k)
```

**æœŸå¾…åŠ¹æœ**: é‡è¤‡ã‚¯ã‚¨ãƒªã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“90%å‰Šæ¸›

#### 3. åŸ‹ã‚è¾¼ã¿ç”Ÿæˆã‚­ãƒ£ãƒƒã‚·ãƒ¥

```python
# utils/embedding.py ã§ã®å®Ÿè£…ä¾‹
class EmbeddingCache:
    def __init__(self, cache_dir="./cache/embeddings"):
        self.cache_dir = Path(cache_dir)
        self.cache_dir.mkdir(parents=True, exist_ok=True)
        self._cache = {}
    
    def get_embedding(self, text: str):
        key = hashlib.md5(text.encode()).hexdigest()
        if key in self._cache:
            return self._cache[key]
        # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰èª­ã¿è¾¼ã¿ã¾ãŸã¯æ–°è¦ç”Ÿæˆ
```

**æœŸå¾…åŠ¹æœ**: åŸ‹ã‚è¾¼ã¿è¨ˆç®—æ™‚é–“80%å‰Šæ¸›

#### 4. éåŒæœŸAPIå‡¦ç†

```python
# src/chat_server.py ã§ã®å®Ÿè£…ä¾‹
from concurrent.futures import ThreadPoolExecutor
import asyncio

executor = ThreadPoolExecutor(max_workers=4)

@app.post("/chat")
async def chat(req: ChatRequest):
    loop = asyncio.get_event_loop()
    
    # CPUé›†ç´„çš„ãªå‡¦ç†ã‚’åˆ¥ã‚¹ãƒ¬ãƒƒãƒ‰ã§å®Ÿè¡Œ
    result = await loop.run_in_executor(
        executor, 
        generate_response, 
        prompt
    )
    return result
```

**æœŸå¾…åŠ¹æœ**: åŒæ™‚å‡¦ç†èƒ½åŠ›3-5å€å‘ä¸Š

### æ€§èƒ½ç›£è¦–

```bash
# ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç›£è¦–
docker stats sfc-llm

# ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“æ¸¬å®š
python scripts/test_search_performance.py

# GPUä½¿ç”¨ç‡ç¢ºèªï¼ˆGPUä½¿ç”¨æ™‚ï¼‰
nvidia-smi
```

### ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢æ¨å¥¨ä»•æ§˜

#### æœ€å°æ§‹æˆ
- **CPU**: 4ã‚³ã‚¢ä»¥ä¸Š
- **ãƒ¡ãƒ¢ãƒª**: 16GBä»¥ä¸Š
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: 50GBä»¥ä¸Š

#### æ¨å¥¨æ§‹æˆ
- **CPU**: 8ã‚³ã‚¢ä»¥ä¸Š
- **ãƒ¡ãƒ¢ãƒª**: 32GBä»¥ä¸Š
- **GPU**: NVIDIA GPU 12GB VRAMä»¥ä¸Šï¼ˆRTX 3060 Ti/4070ä»¥ä¸Šï¼‰
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: SSD 100GBä»¥ä¸Š

#### æœ¬æ ¼é‹ç”¨æ§‹æˆ
- **CPU**: 16ã‚³ã‚¢ä»¥ä¸Š
- **ãƒ¡ãƒ¢ãƒª**: 64GBä»¥ä¸Š
- **GPU**: NVIDIA A100/H100ã¾ãŸã¯è¤‡æ•°GPU
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: NVMe SSD 200GBä»¥ä¸Š

### å®Ÿè£…å„ªå…ˆåº¦

1. **é«˜å„ªå…ˆåº¦**ï¼ˆå³åŠ¹æ€§ã‚ã‚Šï¼‰
   - ãƒ¢ãƒ‡ãƒ«é‡å­åŒ–ã¨GPUãƒ¡ãƒ¢ãƒªæœ€é©åŒ–
   - æ¤œç´¢çµæœã‚­ãƒ£ãƒƒã‚·ãƒ¥
   - APIéåŒæœŸå‡¦ç†

2. **ä¸­å„ªå…ˆåº¦**
   - åŸ‹ã‚è¾¼ã¿ã‚­ãƒ£ãƒƒã‚·ãƒ¥
   - ãƒãƒƒãƒå‡¦ç†å¯¾å¿œ
   - ãƒ¬ã‚¹ãƒãƒ³ã‚¹åœ§ç¸®

3. **ä½å„ªå…ˆåº¦**ï¼ˆé•·æœŸçš„æ”¹å–„ï¼‰
   - Rediså¤–éƒ¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥
   - é«˜åº¦ãªãƒ¬ãƒ¼ãƒˆåˆ¶é™
   - åˆ†æ•£å‡¦ç†å¯¾å¿œ

---

## ğŸ¤ ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ã®è²¢çŒ®ã‚’æ­“è¿ã—ã¾ã™ã€‚ä»¥ä¸‹ã®æ‰‹é †ã§é–‹ç™ºã«å‚åŠ ã§ãã¾ã™ï¼š

1. ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒ•ã‚©ãƒ¼ã‚¯ã™ã‚‹
2. æ©Ÿèƒ½è¿½åŠ ã‚„ãƒã‚°ä¿®æ­£ã®ãŸã‚ã®ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆã™ã‚‹ (`git checkout -b feature/amazing-feature`)
3. å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆã™ã‚‹ (`git commit -m 'Add some amazing feature'`)
4. ãƒ–ãƒ©ãƒ³ãƒã‚’ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹ (`git push origin feature/amazing-feature`)
5. ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹

### é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

- ã‚³ãƒ¼ãƒ‰ã¯[PEP 8](https://pep8.org/)ã‚¹ã‚¿ã‚¤ãƒ«ã‚¬ã‚¤ãƒ‰ã«å¾“ã£ã¦ãã ã•ã„
- æ–°ã—ã„æ©Ÿèƒ½ã«ã¯é©åˆ‡ãªãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã—ã¦ãã ã•ã„
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°ã—ã¦ãã ã•ã„
- ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯æ˜ç¢ºã§èª¬æ˜çš„ã«ã—ã¦ãã ã•ã„

---

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯MITãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ä¸‹ã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚è©³ç´°ã¯[LICENSE](LICENSE)ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
